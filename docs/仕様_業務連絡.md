# 業務連絡 仕様

## 役割
- 重要/通常の業務連絡を一覧表示し、詳細をダイアログで確認するセクション。

## 構成
- ソース: `components/dashboard/business-communications.tsx`。
- レイアウト: グラデーション帯のヘッダー（アイコン＋「Lifecycle management」ラベル＋件数バッジ） → タブバー（全件/対応必須/緊急/共有済み/共有待ち） → オーディエンス/状態の2種セレクト → 横スクロールのフィルタボタン → カード型リスト。
- UI部品: `Tabs`、`Select`、`ScrollArea`、`Button`、`Badge`、`Dialog`（Radixベース）、`lucide`アイコン（`FileText` など）。

## データ
- `data/business-communications.ts` のモック配列 `businessComms` を import して使用。
  - フィールド: `id`, `type` ("normal"|"urgent"|"checked"), `status` (例: "緊急"|"普通"), `title`, `dept`, `date`, `content`, `publishPeriod?` `{ start, end }`, `todoPeriod?` `{ start, end }`, `todoRequired` (boolean), `todoDone` (boolean), `sharedDone` (boolean), `audience` ("全PTR"|"SSV以上"|"SM"|"社員"), `hasAttachment` (boolean), `categories` (string[]: フィルタカテゴリ)。
  - ベース＋拡張で約50件。先頭に多カテゴリ（10タグ以上）を持つテスト用レコード（id:51, 2025/12/01, audience=全PTR）を配置し、タグ省略表示を確認できるようにしている。

## 挙動
- リストアイテムクリックで `Dialog` が開き、バッジ・日時・タイトル・発信元・本文・添付風エリアを表示。
- モーダルの閉じる操作は右上外側に配置した「×」ボタンで行う。白丸背景にグレーの×、薄い枠線と影を付与。
- モーダル内の印刷ボタンは上段に単独で配置し、バッジ＋タイトル行から分離する。
- タイトル行の「＜＞」ボタン内側幅に合わせ、タイトル下の詳細・本文・アクションも左右インセットする。
- モーダルのタイトル左右に「＜」「＞」ボタンを配置し、その間にステータスバッジとタイトルを並べる。現在表示中リスト内の前後業務連絡へ内容を切り替える。
- スクロール領域は `max-h-[620px]`＋`custom-scrollbar`。プレビュー時は5件目をグラデーションで半分だけ見せ、展開後は最大12件。
- モーダル本文は内側スクロールで `max-h-[70vh]`。印刷時は高さ制限とオーバーフローを解除して全量表示。
- リスト行はカード型に変更。リング付きの淡色背景で緊急（アンバー系）/checked（エメラルド系）/通常（ホワイト）の3トーンを使い、影と角丸でダッシュボード風に寄せた。
- フィルタ: タグ行は初期表示オン（toggleは維持）で、`Select` による「対象」（audience）と「状態」（緊急/対応必須/共有済み/共有待ち/添付あり/すべて）を追加。タブ選択（全件/対応必須/緊急/共有済み/共有待ち）→Select→タグフィルタの順に絞り込みを適用。ALLでタグ絞り込み解除。新着順ボタンはUIのみ（ダミー）。
- 左列の2アイコンは継続（TODO実施状況、店内共有状況）。TODO不要は左アイコンを不可視プレースホルダーで幅確保。
- タイトル行: ステータスバッジは丸型・最小幅約64px、14px太字。対象/対応必須はチップ化し、部署は補助テキストで並列表示。
- タグ表示: 背景白＋枠線の丸チップに変更し、ハッシュ記号付き。オーバーフロー時は右端に「...」を重ねる挙動は維持（リサイズで再計測）。
- 右端: 添付ありは黒背景の丸アイコンに変更。日付は `yyyy年MM月dd日(EEE) HH:mm (n日前)` で表示。添付なしでも日付位置がずれないようプレースホルダーで確保。
- ヘッダー: グラデーション帯とアイコンを追加し、フィルタ後件数/全件数をバッジとテキストで表示。タブのアクティブ状態はグリーンの下線で示す。
- その他（Markdown描画の仕様、対応期間表示、タグ表示、アクションボタンの挙動など）は従来通りで、印刷ルールもそのまま維持。

## 今後の検討メモ
- フィルタ・ソートの実装時は `type/status/dept/date` をキーに処理を追加。
- 添付表示やリンク遷移を行う場合はデータモデル拡張（添付URL/種別）。
- リストの読み込み元をAPI化する場合、ローディング/エンプティ/エラーの状態コンポーネント追加を想定。
