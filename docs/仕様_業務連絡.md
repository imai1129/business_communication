# 業務連絡 仕様

## 役割
- 重要/通常の業務連絡を一覧表示し、詳細をダイアログで確認するセクション。

## 構成
- ソース: `components/dashboard/business-communications.tsx`。
- レイアウト: 見出しと並び順ボタン → 横スクロールのフィルタボタン → スクロール可能なリスト。
- UI部品: `Button`、`Badge`、`ScrollArea`、`Dialog`（Radixベース）、`lucide`アイコン（`FileText` など）。

## データ
- `data/business-communications.ts` のモック配列 `businessComms` を import して使用。
  - フィールド: `id`, `type` ("normal"|"urgent"|"checked"), `status` (例: "緊急"|"普通"), `title`, `dept`, `date`, `content`, `todoRequired` (boolean), `todoDone` (boolean), `sharedDone` (boolean), `audience` ("全PTR"|"SSV以上"|"SM"|"社員"), `hasAttachment` (boolean), `categories` (string[]: フィルタカテゴリ)。
  - ベース＋拡張で約50件。先頭に多カテゴリ（10タグ以上）を持つテスト用レコード（id:51, 2025/12/01, audience=全PTR）を配置し、タグ省略表示を確認できるようにしている。

## 挙動
- リストアイテムクリックで `Dialog` が開き、バッジ・日時・タイトル・発信元・本文・添付風エリアを表示。
- スクロール領域に `max-h-[600px]` を設定し、`custom-scrollbar` クラスを付与（スタイルはグローバル想定）。
- フィルタは一覧ページでは常時表示。トップページではトグルボタンで開閉可（初期クローズ）、タグを複数選択すると `categories` に含まれるものだけを OR で表示。ALL でフィルタ解除。新着順ボタンはUIのみでロジックなし（現状ダミー）。
- 左列に2つのステータスアイコン: 左=TODO実施状況（未実施は空円、実施済みはチェック）、右=店内共有状況（メガホンアイコンで未共有は淡色、共有済みはブランドグリーン）。TODOが不要な項目は左アイコンを表示せず、不可視プレースホルダーで幅だけ確保（右アイコン位置がずれないようにする）。
- 対象表示: 部署の代わりに「対象：{audience}」を表示。
- タグ表示: タイトル下の「対象：{audience}」右に `categories` をハッシュ記号（`#`）付きチップとして横並び表示。背景/枠なしのフラット表示、文字は12px。タグ行は単行でオーバーフローを隠し、幅不足時は右端に「...」を重ねて省略（幅ベース）。リサイズ時も再計測。
- 添付: `hasAttachment` が true のとき行右端に黒色のクリップアイコン（大きめ、バッジと同程度の高さに揃える）を表示。アイコンの下に日付を縦配置し、添付有無で日付位置がずれないようプレースホルダーで高さを確保。
- 緊急/チェック済みはバッジ色で表現（`type`/`status` に基づく）。ステータスバッジは文字14px・太字で高さ約8、最小幅60px程度に統一。チェックマークがない行でも同じ幅をプレースホルダーで確保し、行頭位置を揃える。
- 日付表示: `YYYY/MM/DD HH:mm` 形式で表示（「◯日前」など相対時間は付与しない）。
- 緊急行の背景: `status === "緊急"` の場合、リスト行の背景に薄い赤 (`bg-red-50`) を敷く。
- バッジ幅: ステータスバッジは固定幅ではなく最小幅（約60px）で揃え、14px文字に合わせた高さ8を採用。
- 表示件数と展開: 初期状態は4件表示＋5件目を半分だけプレビュー（グラデーションでトリミング）。「もっと見る」ボタンで内部スクロールは解除し、最大12件までページのフロー内で表示（内部スクロールなし）。展開後は「一覧ページへ」ボタンを表示。フィルタが有効でも同ロジックを適用。`/business-communications` では全件表示。
- 一覧ページ: `/business-communications` では `forceExpanded` で全件展開表示（プレビューや「もっと見る」ボタンなし）。ヘッダー検索やフィルタは共通挙動。
- 一覧ページへの導線: トップの業務連絡セクションで全件展開した際、「一覧ページへ」ボタンから `/business-communications` に遷移。
- データ件数: モックデータは約50件（8件のベースデータ＋42件のサンプル生成）でフィルタ/展開動作を確認できる量を保持。
- ダイアログ内タグ表示: 詳細ダイアログではタグを改行可のリストとして全件表示（省略なし）。12px・ハッシュ付きのフラット表示（背景なし）で並べる。
- ダイアログヘッダー右上に印刷ボタンを配置（クリックでブラウザの印刷ダイアログを開く）。ステータスバッジとタイトルと並列で表示。現在のバージョンでは印刷ボタンは非表示（直接ブラウザの印刷機能を利用）。印刷時はA4縦・ページマージン12mmで、ダイアログは画面幅いっぱい（positionは印刷用に静的配置）に広げて出力。枠線/影なし・白背景/黒文字で、本文は `role="document"` に追加余白を設けず（余白は印刷設定に委ねる）印刷。overlayや `print-hidden` は印刷時に非表示。印刷対象は開いている業務連絡ダイアログのみ（他のポータル要素やページ本体は印刷時に非表示）。
- ダイアログのフッター: 共有ボタンは状態に応じて「店内共有済にする」→「店内共有済み」とトグル。TODO必須の場合のみ「対応実施済にする」→「対応実施済み」のボタンを表示し、不要な業務連絡では非表示。対応を実施済みにすると店内共有済みも自動でオンになる（解除しても共有状態は維持）。

## 今後の検討メモ
- フィルタ・ソートの実装時は `type/status/dept/date` をキーに処理を追加。
- 添付表示やリンク遷移を行う場合はデータモデル拡張（添付URL/種別）。
- リストの読み込み元をAPI化する場合、ローディング/エンプティ/エラーの状態コンポーネント追加を想定。
